# 코드 리뷰 이슈 목록 (한국어)

## 개요
Azure Functions OpenAPI 프로젝트의 전체 코드 리뷰를 수행한 결과, **14개의 개선 이슈**를 발견했습니다.
각 이슈는 작은 단위로 구성되어 독립적으로 처리할 수 있도록 설계되었습니다.

---

## 🔴 긴급 우선순위 (3개 이슈)

즉시 수정이 필요한 버그들입니다:

### 이슈 #1: 캐시 로직 버그 수정 - Falsy 값 처리
- **파일**: `cache.py`
- **문제**: 캐시가 falsy 값(0, False, "")을 캐시 미스로 처리함
- **영향도**: 높음 - falsy 값을 반환하는 함수의 캐싱이 작동하지 않음
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/01-cache-falsy-value-bug.md`

**설명**: 현재 `if cached_result is not None:` 조건문은 0, False, 빈 문자열 등의 유효한 캐시 값을 None으로 취급하여 함수를 재실행합니다. Sentinel 값 패턴을 사용하여 "캐시에 없음"과 "캐시된 falsy 값"을 구분해야 합니다.

### 이슈 #2: monitor_performance 데코레이터의 return 문 누락 수정
- **파일**: `monitoring.py`
- **문제**: 데코레이터가 wrapper 함수를 반환하지 않고 None을 반환함
- **영향도**: 높음 - 모든 데코레이트된 함수가 작동하지 않음
- **작업량**: 매우 소규모 (5-10분)
- **상세 문서**: `docs/issues/02-missing-return-in-decorator.md`

**설명**: `monitor_performance` 함수의 끝에 `return wrapper`가 누락되어 있습니다. 이로 인해 데코레이터가 None을 반환하여 TypeError가 발생합니다.

### 이슈 #3: ServerInfo 카운터 연산에 스레드 안전성 추가
- **파일**: `server_info.py`
- **문제**: 카운터 증가 메서드에 경쟁 조건이 있음
- **영향도**: 높음 - 멀티스레드 환경에서 부정확한 카운트
- **작업량**: 소규모 (2-3시간)
- **상세 문서**: `docs/issues/03-thread-safety-serverinfo.md`

**설명**: `increment_request_count()` 및 `increment_error_count()` 메서드가 락 없이 공유 상태를 수정하여 Azure Functions의 멀티스레드 환경에서 경쟁 조건이 발생합니다.

---

## 🟠 높은 우선순위 (2개 이슈)

조속히 처리해야 할 보안 개선 사항입니다:

### 이슈 #4: Swagger UI의 HTML 새니타이제이션 개선
- **파일**: `swagger_ui.py`
- **문제**: HTML 인코딩된 엔티티를 처리하지 못함
- **영향도**: 보안 - XSS 취약점
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/04-html-sanitization-improvement.md`

**설명**: 현재 구현은 원시 특수 문자만 제거하지만 `&lt;script&gt;`와 같은 HTML 인코딩된 엔티티는 브라우저가 디코딩하여 실행할 수 있습니다. Python의 `html.escape()`를 사용해야 합니다.

### 이슈 #5: URL 새니타이제이션 우회 위험 수정
- **파일**: `swagger_ui.py`
- **문제**: URL 검증이 인코딩으로 우회될 수 있음
- **영향도**: 보안 - XSS 및 SSRF 위험
- **작업량**: 중간 (2-3시간)
- **상세 문서**: `docs/issues/05-url-sanitization-bypass.md`

**설명**: 대소문자 구분 없는 패턴 매칭은 `Java&#x3A;script:` 또는 `data\x00:URI`와 같은 변형을 놓칠 수 있습니다. `urllib.parse`를 사용한 적절한 URL 파싱이 필요합니다.

---

## 🟡 중간 우선순위 (5개 이슈)

코드 품질 및 기능 개선 사항입니다:

### 이슈 #6: 라우트 검증 패턴에서 공백 제거
- **파일**: `utils.py`
- **문제**: 라우트 검증이 공백을 허용함 (RFC 위반)
- **영향도**: 중간 - 잠재적 라우팅 문제
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/06-route-validation-spaces.md`

**설명**: 정규식 패턴 `r"^/?[a-zA-Z0-9_\-/{}\s]*$"`에 `\s`가 포함되어 있어 공백이 허용됩니다. RFC 3986에 따르면 URI에는 공백이 허용되지 않습니다.

### 이슈 #7: OpenAPI 스키마 생성의 오류 처리 개선
- **파일**: `openapi.py`
- **문제**: 자동 폴백이 스키마 생성 오류를 숨김
- **영향도**: 중간 - 문제 해결이 어려움
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/07-error-handling-schema-generation.md`

**설명**: Pydantic 모델 변환이 실패하면 디버그 수준 로그만 남기고 `{"type": "object"}`로 폴백합니다. 더 나은 오류 메시지와 경고 수준 로깅이 필요합니다.

### 이슈 #8: CLI 출력 포맷팅 코드 중복 리팩토링
- **파일**: `cli.py`
- **문제**: 세 개의 핸들러가 동일한 출력 로직을 가짐
- **영향도**: 중간 - 유지보수 부담
- **작업량**: 중간 (2-3시간)
- **상세 문서**: `docs/issues/08-cli-code-duplication.md`

**설명**: `handle_info()`, `handle_health()`, `handle_metrics()` 함수가 JSON/YAML 출력 포맷팅을 위한 동일한 코드를 반복합니다. 공유 헬퍼 함수로 추출해야 합니다.

### 이슈 #9: validate_openapi_spec에 입력 타입 검증 추가
- **파일**: `cli.py`
- **문제**: 딕셔너리 접근 전에 타입 체크가 없음
- **영향도**: 중간 - 잘못된 입력에서 크래시 가능
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/09-cli-type-validation.md`

**설명**: YAML 파서가 None이나 다른 비-딕셔너리 타입을 반환할 때 타입 체크 없이 딕셔너리 키에 접근하면 TypeError가 발생합니다.

### 이슈 #14: 플레이스홀더 응답 시간 추정을 실제 메트릭으로 교체
- **파일**: `server_info.py`
- **문제**: 실제 데이터 대신 하드코딩된 0.1초
- **영향도**: 중간 - 오해를 불러일으키는 메트릭
- **작업량**: 소규모 (2-3시간)
- **상세 문서**: `docs/issues/14-response-time-placeholder.md`

**설명**: `_estimate_response_time()` 메서드가 항상 0.1을 반환합니다. `PerformanceMonitor`와 통합하여 실제 평균 응답 시간을 반환해야 합니다.

---

## 🟢 낮은 우선순위 (4개 이슈)

좋은 개선 사항 및 최적화입니다:

### 이슈 #10: 캐시 키 생성 성능 최적화
- **파일**: `cache.py`
- **문제**: JSON 직렬화가 빈번한 호출에 대해 느림
- **영향도**: 낮음 - 성능 최적화
- **작업량**: 중간 (3-4시간)
- **상세 문서**: `docs/issues/10-cache-key-performance.md`

**설명**: 모든 함수 인자를 JSON 직렬화하는 것은 느립니다. 고성능 시나리오를 위한 커스텀 키 생성 함수를 허용해야 합니다.

### 이슈 #11: 캐시 적중/미스 통계 추가
- **파일**: `cache.py`
- **문제**: 캐시 효과성에 대한 가시성 없음
- **영향도**: 낮음 - 관찰 가능성 개선
- **작업량**: 소규모 (2-3시간)
- **상세 문서**: `docs/issues/11-cache-statistics.md`

**설명**: 캐시 적중률, 미스율 등을 추적하지만 공개 API로 노출하지 않습니다. 통계 메서드를 추가해야 합니다.

### 이슈 #12: 응답 시간 저장을 위해 List를 Deque로 교체
- **파일**: `monitoring.py`
- **문제**: 비효율적인 O(n) pop(0) 연산
- **영향도**: 낮음 - 성능 최적화
- **작업량**: 소규모 (1-2시간)
- **상세 문서**: `docs/issues/12-deque-response-times.md`

**설명**: `list.pop(0)`는 O(n) 연산입니다. `collections.deque`를 `maxlen`과 함께 사용하면 O(1) 성능을 얻을 수 있습니다.

### 이슈 #13: 정확한 중앙값 계산을 위해 statistics.median() 사용
- **파일**: `monitoring.py`
- **문제**: 짝수 길이 리스트에 대한 부정확한 중앙값
- **영향도**: 낮음 - 통계적 정확성
- **작업량**: 소규모 (1시간)
- **상세 문서**: `docs/issues/13-median-calculation.md`

**설명**: `count // 2`를 사용하면 짝수 길이 리스트에 대해 낮은 중앙값을 제공합니다. `statistics.median()`을 사용하면 정확한 중앙값(두 중간 값의 평균)을 얻을 수 있습니다.

---

## 통계 요약

| 우선순위 | 개수 | 총 작업량 |
|---------|------|----------|
| 🔴 긴급 | 3 | ~4-6시간 |
| 🟠 높음 | 2 | ~3-5시간 |
| 🟡 중간 | 5 | ~9-13시간 |
| 🟢 낮음 | 4 | ~7-10시간 |
| **합계** | **14** | **~23-34시간** |

## 카테고리별 분류

| 카테고리 | 개수 |
|---------|------|
| 버그 수정 | 5 |
| 보안 | 3 |
| 코드 품질 | 3 |
| 성능 | 3 |
| 모니터링/관찰성 | 4 |
| 문서화 | 1 |

## 권장 구현 순서

1. **1단계 - 긴급 버그** (우선순위: 즉시)
   - 이슈 #2: 데코레이터의 return 누락 (5-10분) ⚡
   - 이슈 #1: 캐시 falsy 값 버그 (1-2시간)
   - 이슈 #3: 스레드 안전성 (2-3시간)

2. **2단계 - 보안** (우선순위: 높음)
   - 이슈 #4: HTML 새니타이제이션 (1-2시간)
   - 이슈 #5: URL 새니타이제이션 (2-3시간)

3. **3단계 - 코드 품질** (우선순위: 중간)
   - 이슈 #7: 오류 처리 (1-2시간)
   - 이슈 #9: 타입 검증 (1-2시간)
   - 이슈 #8: 코드 중복 (2-3시간)
   - 이슈 #6: 라우트 검증 (1-2시간)
   - 이슈 #14: 응답 시간 메트릭 (2-3시간)

4. **4단계 - 개선 사항** (우선순위: 낮음)
   - 이슈 #13: 중앙값 계산 (1시간) ⚡
   - 이슈 #12: Deque 최적화 (1-2시간)
   - 이슈 #11: 캐시 통계 (2-3시간)
   - 이슈 #10: 캐시 키 최적화 (3-4시간)

⚡ = 빠른 수정

## GitHub 이슈 생성 가이드

### 각 이슈 파일에는 다음이 포함되어 있습니다:
- 상세한 문제 설명
- 현재 동작 vs 예상 동작
- 코드 예제가 포함된 제안 솔루션
- 테스트 케이스
- 영향 평가
- 작업량 추정
- 관련 이슈

### 사용할 라벨:
- `bug` - 코드 결함
- `security` - 보안 취약점
- `enhancement` - 새 기능 또는 개선
- `performance` - 성능 최적화
- `refactoring` - 코드 품질 개선
- `good-first-issue` - 신규 기여자에게 좋음
- `critical` - 긴급 이슈
- `high-priority` - 중요 이슈
- `medium-priority` - 표준 우선순위
- `low-priority` - 좋은 개선사항
- `quick-fix` - 빠르게 수정 가능

## 다음 단계

1. `docs/issues/` 디렉토리의 모든 이슈 파일 검토
2. 각 개선 사항에 대한 GitHub 이슈 생성
3. 우선순위 및 담당자 할당
4. 1단계(긴급 버그)부터 시작
5. 진행 상황 추적 및 필요에 따라 우선순위 조정

---

**참고**: 모든 이슈는 독립적으로 작업할 수 있도록 설계되었으며, 서로 다른 개발자가 병렬로 작업할 수 있습니다.
